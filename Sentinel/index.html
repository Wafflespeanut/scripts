<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>Sentinel | A messy cipher...</title>
	
<style>
textarea {border:1px solid green; padding: 7px 7px; background: black; color:white; font-family:Lucida console}
</style>

  </head>

  <body>

    <header>
      <div class="container">
        <h1>Sentinel</h1>
        <h2>A messy cipher...</h2>

        <section id="downloads">
          <a href="http://wafflespeanut.github.io" class="btn btn-blog"><span class="icon"></span>Home</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">

<form action="form_action.asp">
<table border="0" cellspacing="0"><tr>
<h3>Text input:</h3>
<center><p><textarea  style="width: 1000px; height: 130px;" id="cipherspace" placeholder="Gimme something to eat!">Hello, world!</textarea></p></center></tr>
<p><tr><td><h3>Password:</h3><textarea style="width: 200px; height: 40px;" id="keyspace" placeholder="I need a wrapper!">Sentinel-101</textarea></td>
<td><br><input type="radio" name="cipher" value="encrypt" checked> <strong>Encrypt</strong><br>
<input type="radio" name="cipher" value="decrypt"> <strong>Decrypt</strong></td>
<td><br><br><span onmouseover="this.className='hoverMouse'" onmouseout="this.className=''"><button class="button-error pure-button" type="button" onclick="zombify()">BOOM!!!</button></span></p></td>
<td><p><h3>CAUTION: (PROTOTYPE VERSION) </h3><font color="#b5e853">Use at your own risk!<br>Encrypting more than twice,<br> may <em>"kill"</em> your browser!</font></p></td>
</tr></table>
</form>
<script type="text/javascript">

function zombify() {
	phr = document.getElementById("cipherspace").value
	k = document.getElementById("keyspace").value
	if( phr==0 || k==0 ) {
		alert("C'mon... Fill up the input");
		return false }
	cipher = document.forms[0].cipher
	if(cipher[0].checked)
		cipherout = eit(phr,k)
	else if(cipher[1].checked) {
		if(test(phr))
			cipherout = dit(phr,k)
		else {
			alert("Invalid ciphertext! Is it encrypted?")
			document.getElementById("cipherspace").value = ""
			document.getElementById("keyspace").value = ""
			return false } }
	document.getElementById("cipherspace").value = cipherout
	return cipherout }

function test(phr) {
	str=hexed(chared(phr)).join('');
	for(i=0;i<str.length;i++) {
		if(parseInt(str[i])==0)
			return false }
	return true }

function shift(hand,shift) {
		newt=[]; s=parseInt(shift)
		for(i=0;i<hand.length;i++) {
			m=hand[i].charCodeAt()+shift
			while(m>255) { m-=255 }
			newt.push(String.fromCharCode(m)) }
	return newt.join('') }

function sieve(n) {
	primes=[]
	if(n>=2) {
		l=Math.sqrt(n)-2; num= new Array()
		for(i=2; i<= n;i++)
			num.push(i)
        for(i=0;i<=l;i++) {
			var p=num[i]
			if(p)
				for(j=p*p-2;j<num.length;j+=p)
					num[j]=0; }
		for(i=0;i<num.length;i++) {
			p=num[i];
			if(p)
				primes.push(p); } }
	return primes }

function primelist(level) {
	k=Math.pow(2,3+level)
	return sieve(k*k) }

function hexed(key)	{
	pas=key.split('')
	for(i=0;i<key.length;i++) {
		pas[i]=pas[i].charCodeAt().toString(16) }
	return pas }

function chared(key) {
	pas=[]; keyc=[]; m=0
	while(m<key.length) {
		keyc.push(subarr(key,m,m+2).join(''))
		m+=2 }
	for(i=0;i<keyc.length;i++)
		pas.push(String.fromCharCode(parseInt(keyc[i],16)))
	return pas.join('') }

String.prototype.replaceAt = function(i,ch) {
    return this.substr(0,i) + ch + this.substr(i+ch.length); }

function dupe(arr) {
	return arr.filter(function(elem, pos) {
		return arr.indexOf(elem) == pos }) }

function add(text,key) {
	num="0123456789"; hand=text; i=key.length-1
	for(a=0;a<hand.length;a++) {
		if(i>0 && num.indexOf(hand[a])!=-1) {
			b=(parseInt(hand[a])+key[i].charCodeAt()).toString()
			hand=hand.replaceAt(a,b[b.length-1])
			i-=1 }
		else if(i==0 && num.indexOf(hand[a])!=-1) {
			i=key.length-1
			b=(parseInt(hand[a])+key[i].charCodeAt()).toString()
			hand=hand.replaceAt(a,b[b.length-1])
			i-=1 } }
	return hand }
	
function sub(text,key) {
	num="0123456789"; hand=text; i=key.length-1
	for(a=0;a<hand.length;a++) {
		if(i>0 && num.indexOf(hand[a])!=-1) {
			c=(key[i].charCodeAt()).toString()
			b=(10+parseInt(hand[a])-parseInt(c[c.length-1])).toString()
			hand=hand.replaceAt(a,b[b.length-1])
			i-=1 }
		else if(i==0 && num.indexOf(hand[a])!=-1) {
			i=key.length-1
			c=(key[i].charCodeAt()).toString()
			b=(10+parseInt(hand[a])-parseInt(c[c.length-1])).toString()
			hand=hand.replaceAt(a,b[b.length-1])
			i-=1 } }
	return hand }

function keypnum(key) {
	primes = []; plist=primelist(2)
	for(i=0;i<key.length;i++) {
		primes.push(plist[key[i].charCodeAt()]) }
	for(n=1;n<=2;n++) {
			temp = []
		for(i=0;i<primes.length;i++)
			temp.push(primes[i])
		for(i=0;i<temp.length;i++)
			primes.push(plist[temp[i]]) }
	return primes }
	
function pop(key,level) {
	merged=[]; listed=keypnum(key,level); k=0
	p=listed.join(''); n=8
	while(p.length>=n) {
		merged.push(p.substr(0,n))
		p=p.substr(n) }
	for(i=0;i<key.length;i++) {
		k+=parseInt(dupe(merged)[key[i].charCodeAt()]) }
	return k.toString() }

function combine(text,key) {
	phrase=text
	primes=sieve(Math.pow(key.length,2))
	i=0; ph=phrase.length;
	for(j=0;j<key.length;j++) {
		if(primes[i]<phrase.length) {
			phrase=phrase.substr(0,primes[i])+key[j]+phrase.substr(primes[i])
			i+=1 }
	else { break } }
	phr=add(hexed(phrase).join(''),key)
	return phr }

function subarr(arr,index,length) {
	newarr=[]
	for(i=index;i<length;i++) {
		newarr.push(arr[i]) }
	return newarr }
	
function extract(text,key) {
		phrase=chared(sub(text,key));
		primes=subarr(sieve(Math.pow(key.length,2)),0,key.length)
		ph=phrase.length; newp=[]
		for(i=0;i<ph;i++) {
			if(primes.indexOf(i)==-1) {
				newp.push(phrase[i]) }}
	return newp.join('') }

function eit(text,key) {
	combined=combine(text,key);
	rkey=combine(pop(key),key)
	zombie=combine(combine(combined,key),rkey)
	for(i=0;i<key.length;i++)
		zombie=shift(zombie,key[i].charCodeAt())
	return hexed(zombie).join('') }

function dit(text,key) {
	zombie=chared(text)
	for(i=0; i<key.length; i++)
		zombie=shift(zombie,255-(key[i].charCodeAt()))
	rkey=combine(pop(key),key)
	extracted=extract(extract(zombie,rkey),key)
	return extract(extracted,key) }
</script>
<hr> <br>
<p><h2>NOTE:</h2>
<ul>
<li>To the newbies, this is an <a href="https://en.wikipedia.org/wiki/Encryption">encryption</a> cipher. If you've forgot your key (password), then there's no way you can recover your message from the ciphertext. Even a slight variation in the key will lead you to <em>stupid</em> characters... (<a href="http://wp.me/p3OCmi-qT">I've written more about that!</a>)</p>
<p><li>Again, this runs entirely on <em>your</em> browser. If you were to run my original algorithm, higher order iterations and gigantic random keys may crash your browser!</p>
<p>So, I've <em>simplified</em> (reducing security to improve performance) the original version of <strong>Sentinel</strong> (<a href="https://github.com/Wafflespeanut/Python/blob/master/Encryption/Sentinel/Cipher.py">written in Python</a>). Random keygen, and iterations have been "confiscated" <em>(for now)</em>...</p></ul>
      </section>
    </div>
  </body>
</html>